<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Find The Flag{% endblock %}</title>
    <link rel="icon" href="/assets/img/earth-icon.svg">
    {% block stylesheets %}
        {{ encore_entry_link_tags('app') }}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <link href="{{ asset('assets/game-find-the-flag.css') }}" rel="stylesheet">
    {% endblock %}
</head>
<body>
    <main class="d-flex flex-column vh-100 align-items-center">
        {% block body %}
            <div class="position-relative w-100">
                <img src="{{ data.img }}" alt="game-img" class="game-img w-100">
                <h1 class="game-title text-light position-absolute">{{ data.title }}</h1>
            </div>

            <div class="d-flex flex-column justify-content-center align-items-center">

                <p>{{ data.description }}</p>
                <label for="select-level">
                    Mode :
                    <select id="select-level" class="form-select" aria-label="select game">
                        <option value="solo" selected>Single Player</option>
                        <option value="multi">Multi Player</option>
                    </select>
                </label>
                <label for="select-level">
                    Level :
                    <select class="form-select" aria-label="select game">
                        {% for option in data.levels.toArray %}
                            <option value="{{ option.difficulty }}">
                                {{ option.label }} {{ option.difficulty }}
                            </option>
                        {% endfor %}
                    </select>
                </label>
                <button type="button" class="btn btn-primary mt-3">Start</button>
            </div>
        {% endblock %}
    </main>

{% block javascripts %}
    {{ encore_entry_script_tags('app') }}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script>
        // WebSocket

        let socket = new WebSocket("ws://localhost:9000");

        socket.onopen = () => {
            console.log("FindTheFlagServer : CONNECTED");
            // const request = {
            //     event: '@GetMessages'
            // };
            // socket.send(JSON.stringify(request));
        }

        socket.onmessage = (event) => {
            try {
                const response = JSON.parse(event.data);
                switch (response.event) {
                    // case '@Message':
                    //     addMessage(response.response);
                    //     break;
                    // case '@Messages':
                    //     addMessages(response.response)
                    //     break;
                    // case '@ConnectionCount':
                    //     updateOnline(response.response.count)
                    //     break;
                }
            } catch (e) {
                // Catch any errors
            }
        };

        socket.onclose = () => {
            console.warn('Connection lost, retry in 30 seconds...')
            setTimeout(() => {
                const closeFunction = socket.onclose;
                const openFunction = socket.onopen;
                const messageFunction = socket.onmessage;
                socket = null;
                socket = new WebSocket("ws://localhost:8001");
                socket.onclose = closeFunction;
                socket.onopen = openFunction;
                socket.onmessage = messageFunction
            }, 30000)
        }
    </script>
{% endblock %}
</body>
</html>

